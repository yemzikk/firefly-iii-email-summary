<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Firefly III Monthly Report - Preview</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@500&display=swap");

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          "Helvetica Neue", Arial, sans-serif;
        line-height: 1.6;
        color: #1a1a1a;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .header h1 {
        margin: 0;
        font-size: 32px;
        font-weight: 700;
        letter-spacing: -0.5px;
      }
      .header p {
        margin: 10px 0 0 0;
        opacity: 0.95;
        font-size: 17px;
        font-weight: 400;
        letter-spacing: 0.2px;
      }
      .section {
        background: white;
        padding: 25px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
      }
      h3 {
        margin: 0 0 20px 0;
        color: #667eea;
        font-size: 22px;
        font-weight: 700;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 10px;
        letter-spacing: -0.3px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      th {
        background-color: #f8f9fa;
        padding: 12px;
        text-align: left;
        font-weight: 600;
        color: #495057;
        border-bottom: 2px solid #dee2e6;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.8px;
      }
      td {
        padding: 14px 12px;
        border-bottom: 1px solid #f0f0f0;
        font-size: 15px;
      }
      tr:last-child td {
        border-bottom: none;
      }
      tr:hover {
        background-color: #f8f9fa;
      }
      .amount {
        font-weight: 600;
        font-family: "JetBrains Mono", "SF Mono", "Monaco", "Inconsolata",
          "Fira Code", "Droid Sans Mono", "Courier New", monospace;
        font-size: 15px;
        letter-spacing: -0.3px;
        white-space: nowrap;
      }
      .positive {
        color: #28a745;
      }
      .negative {
        color: #dc3545;
      }
      .zero {
        color: #999;
        font-style: italic;
      }
      .summary-row {
        background-color: #f8f9fa;
        font-weight: 600;
      }
      .total-row {
        color: white;
        font-weight: 700;
        font-size: 17px;
      }
      .total-row.positive {
        background-color: #28a745;
      }
      .total-row.negative {
        background-color: #dc3545;
      }
      .total-row:hover {
        opacity: 0.95;
      }
      .total-row td {
        padding: 16px 12px;
        border-bottom: none;
      }
      .total-row .amount {
        color: white !important;
      }
      .footer {
        text-align: center;
        margin-top: 30px;
        padding: 20px;
        color: #999;
        font-size: 13px;
        font-weight: 400;
      }

      /* Mobile responsive styles */
      @media only screen and (max-width: 600px) {
        body {
          padding: 10px;
        }
        .header {
          padding: 20px;
        }
        .header h1 {
          font-size: 24px;
        }
        .section {
          padding: 15px;
        }
        h3 {
          font-size: 18px;
        }
        th,
        td {
          padding: 10px 8px;
          font-size: 14px;
        }
        .amount {
          font-size: 14px;
        }
        th {
          font-size: 11px;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>üìä Firefly III Monthly Report</h1>
      <p>September 2025</p>
    </div>

    <div class="section">
      <h3>üè∑Ô∏è Category Summary</h3>
      <table>
        <tr>
          <th>Category</th>
          <th style="text-align: right">Total</th>
        </tr>
        <tr>
          <td>Salary</td>
          <td style="text-align: right" class="amount positive">‚Çπ85,000</td>
        </tr>
        <tr>
          <td>Groceries</td>
          <td style="text-align: right" class="amount negative">‚Çπ‚àí12,500</td>
        </tr>
        <tr>
          <td>Transportation</td>
          <td style="text-align: right" class="amount negative">‚Çπ‚àí8,750</td>
        </tr>
        <tr>
          <td>Dining Out</td>
          <td style="text-align: right" class="amount negative">‚Çπ‚àí6,200</td>
        </tr>
        <tr>
          <td>Entertainment</td>
          <td style="text-align: right" class="amount negative">‚Çπ‚àí4,500</td>
        </tr>
        <tr>
          <td>Utilities</td>
          <td style="text-align: right" class="amount negative">‚Çπ‚àí3,800</td>
        </tr>
        <tr>
          <td>Healthcare</td>
          <td style="text-align: right" class="amount negative">‚Çπ‚àí2,100</td>
        </tr>
        <tr>
          <td>Freelance Income</td>
          <td style="text-align: right" class="amount positive">‚Çπ15,000</td>
        </tr>
        <tr class="zero">
          <td>Gifts, Donations, Travel</td>
          <td style="text-align: right" class="amount">‚Çπ0</td>
        </tr>
      </table>
    </div>

    <div class="section">
      <h3>üí∏ Money Flow</h3>
      <div style="position: relative; height: 500px">
        <canvas id="sankeyChart"></canvas>
      </div>
    </div>

    <div class="section">
      <h3>üí∞ Budget Summary</h3>
      <table>
        <tr>
          <th>Budget</th>
          <th style="text-align: right">Limit</th>
          <th style="text-align: right">Spent</th>
          <th style="text-align: right">Remaining</th>
        </tr>
        <tr>
          <td>Food & Groceries</td>
          <td style="text-align: right" class="amount">‚Çπ15,000</td>
          <td style="text-align: right" class="amount negative">‚Çπ12,500</td>
          <td style="text-align: right" class="amount positive">‚Çπ2,500</td>
        </tr>
        <tr>
          <td>Transportation</td>
          <td style="text-align: right" class="amount">‚Çπ10,000</td>
          <td style="text-align: right" class="amount negative">‚Çπ8,750</td>
          <td style="text-align: right" class="amount positive">‚Çπ1,250</td>
        </tr>
        <tr>
          <td>Entertainment</td>
          <td style="text-align: right" class="amount">‚Çπ5,000</td>
          <td style="text-align: right" class="amount negative">‚Çπ4,500</td>
          <td style="text-align: right" class="amount positive">‚Çπ500</td>
        </tr>
        <tr>
          <td>Dining Out</td>
          <td style="text-align: right" class="amount">‚Çπ5,000</td>
          <td style="text-align: right" class="amount negative">‚Çπ6,200</td>
          <td style="text-align: right" class="amount negative">‚Çπ‚àí1,200</td>
        </tr>
        <tr>
          <td>Utilities</td>
          <td style="text-align: right" class="amount">‚Çπ4,000</td>
          <td style="text-align: right" class="amount negative">‚Çπ3,800</td>
          <td style="text-align: right" class="amount positive">‚Çπ200</td>
        </tr>
        <tr>
          <td>Healthcare</td>
          <td style="text-align: right" class="amount">‚Çπ3,000</td>
          <td style="text-align: right" class="amount negative">‚Çπ2,100</td>
          <td style="text-align: right" class="amount positive">‚Çπ900</td>
        </tr>
        <tr class="zero">
          <td>Shopping, Miscellaneous</td>
          <td style="text-align: right" class="amount">‚Çπ8,000</td>
          <td style="text-align: right" class="amount">‚Çπ0</td>
          <td style="text-align: right" class="amount">‚Çπ8,000</td>
        </tr>
      </table>
    </div>

    <div class="section">
      <h3>üìà Financial Overview</h3>
      <table>
        <tr>
          <td>Spent this month:</td>
          <td style="text-align: right" class="amount negative">‚Çπ37,850</td>
        </tr>
        <tr>
          <td>Earned this month:</td>
          <td style="text-align: right" class="amount positive">‚Çπ100,000</td>
        </tr>
        <tr class="summary-row">
          <td><strong>Net change this month:</strong></td>
          <td style="text-align: right" class="amount positive">
            <strong>‚Çπ62,150</strong>
          </td>
        </tr>
        <tr>
          <td>Spent so far this year:</td>
          <td style="text-align: right" class="amount negative">‚Çπ340,650</td>
        </tr>
        <tr>
          <td>Earned so far this year:</td>
          <td style="text-align: right" class="amount positive">‚Çπ900,000</td>
        </tr>
        <tr class="summary-row">
          <td><strong>Net change so far this year:</strong></td>
          <td style="text-align: right" class="amount positive">
            <strong>‚Çπ559,350</strong>
          </td>
        </tr>
        <tr class="total-row positive">
          <td><strong>Current net worth:</strong></td>
          <td style="text-align: right" class="amount">
            <strong>‚Çπ1,245,680</strong>
          </td>
        </tr>
      </table>
    </div>

    <div class="footer">Generated by Firefly III Email Summary</div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-sankey@0.12.0/dist/chartjs-chart-sankey.min.js"></script>
    <script>
      // Sample Sankey data (Income -> Budgets -> Expense Categories + Savings)
      const sankeyData = {
        nodes: [
          { id: "income_Salary", label: "Salary" },
          { id: "income_Freelance", label: "Freelance" },
          { id: "income_hub", label: "Total Income" },
          { id: "budget_Food", label: "Food & Groceries" },
          { id: "budget_Transport", label: "Transportation" },
          { id: "budget_Entertainment", label: "Entertainment" },
          { id: "budget_Dining", label: "Dining Out" },
          { id: "budget_Utilities", label: "Utilities" },
          { id: "budget_Healthcare", label: "Healthcare" },
          { id: "category_Groceries", label: "Groceries" },
          { id: "category_Transport", label: "Transport" },
          { id: "category_Entertainment", label: "Entertainment" },
          { id: "category_Dining", label: "Dining Out" },
          { id: "category_Utilities", label: "Utilities" },
          { id: "category_Healthcare", label: "Healthcare" },
          { id: "savings", label: "Savings" },
        ],
        // Links use node indices (order above) for source/target
        links: [
          { source: 0, target: 2, value: 85000 },
          { source: 1, target: 2, value: 15000 },
          // Income hub -> budgets (allocate spent values + remaining flows)
          { source: 2, target: 3, value: 12500 },
          { source: 2, target: 4, value: 8750 },
          { source: 2, target: 5, value: 4500 },
          { source: 2, target: 6, value: 6200 },
          { source: 2, target: 7, value: 3800 },
          { source: 2, target: 8, value: 2100 },
          // Budgets -> expense categories
          { source: 3, target: 9, value: 12500 },
          { source: 4, target: 10, value: 8750 },
          { source: 5, target: 11, value: 4500 },
          { source: 6, target: 12, value: 6200 },
          { source: 7, target: 13, value: 3800 },
          { source: 8, target: 14, value: 2100 },
          // Savings (net positive)
          { source: 2, target: 15, value: 62150 },
        ],
      };

      const ctx = document.getElementById("sankeyChart");
      const data = {
        datasets: [
          {
            data: sankeyData.links.map((link) => ({
              from: sankeyData.nodes[link.source].label,
              to: sankeyData.nodes[link.target].label,
              flow: link.value,
            })),
            colorFrom: (c) => {
              const fromLabel = c.dataset.data[c.dataIndex].from;
              const toLabel = c.dataset.data[c.dataIndex].to;
              if (toLabel === "Total Income") return "rgba(76,175,80,0.7)"; // income categories to hub
              if (fromLabel === "Total Income" && toLabel === "Savings")
                return "rgba(40,167,69,0.7)";
              if (fromLabel === "Total Income") return "rgba(156,39,176,0.7)"; // hub to budgets
              if (toLabel === "Savings") return "rgba(40,167,69,0.7)";
              if (fromLabel.startsWith("budget_")) return "rgba(220,53,69,0.7)"; // budgets to categories
              return "rgba(27,94,32,0.7)"; // income sources
            },
            colorTo: (c) => {
              const fromLabel = c.dataset.data[c.dataIndex].from;
              const toLabel = c.dataset.data[c.dataIndex].to;
              if (toLabel === "Total Income") return "rgba(102,126,234,0.7)";
              if (toLabel === "Savings") return "rgba(40,167,69,0.7)";
              if (
                toLabel.startsWith("Food") ||
                toLabel.startsWith("Transportation")
              )
                return "rgba(156,39,176,0.7)";
              if (fromLabel.startsWith("Total Income"))
                return "rgba(156,39,176,0.7)";
              if (
                toLabel === "Groceries" ||
                toLabel === "Transport" ||
                toLabel === "Dining Out" ||
                toLabel === "Utilities" ||
                toLabel === "Healthcare" ||
                toLabel === "Entertainment"
              )
                return "rgba(220,53,69,0.7)";
              return "rgba(76,175,80,0.7)";
            },
            borderWidth: 0,
            nodeWidth: 12,
            size: "max",
          },
        ],
      };

      new Chart(ctx, {
        type: "sankey",
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: (context) => {
                  const item = context.dataset.data[context.dataIndex];
                  const totalIncome = 100000; // sample total income
                  const pct = ((item.flow / totalIncome) * 100).toFixed(1);
                  return `${item.from} ‚Üí ${item.to}: ‚Çπ${Math.round(
                    item.flow
                  ).toLocaleString()} (${pct}%)`;
                },
              },
            },
          },
        },
      });
    </script>
  </body>
</html>
